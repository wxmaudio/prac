!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.GameBox=n():t.GameBox=n()}(this,function(){return function(t){function n(e){if(i[e])return i[e].exports;var o=i[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var i={};return n.m=t,n.c=i,n.p="",n(0)}([function(t,n,i){i(10)()},function(t,n){var i={fn:function(){},inherit:function(t,n){var i=new Function;i.prototype=n.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=n.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=n)},extend:function(t,n){var i;for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},addHandler:function(t,n,i){t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent?t.attachEvent("on"+n,i):t["on"+n]=i},removeHandler:function(t,n,i){t.removeEventListener?t.removeEventListener(n,i,!1):t.detachEvent?t.detachEvent("on"+n,i):t["on"+n]=null},isMobile:function(){var t=navigator.userAgent.toLowerCase(),n="ipad"==t.match(/ipad/i),i="iphone os"==t.match(/iphone os/i),e="midp"==t.match(/midp/i),o="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),r="ucweb"==t.match(/ucweb/i),s="android"==t.match(/android/i),a="windows ce"==t.match(/windows ce/i),h="windows mobile"==t.match(/windows mobile/i);"webview"==t.match(/webview/i);return n||i||e||o||r||s||a||h}};t.exports=i},function(t,n,i){var e=i(1),o=i(3),r=function(t){this.x=0,this.y=0,this.rangeX=[-9999,999999],this.rangeY=[-9999,999999],this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.width=0,this.height=0,this.radius=0,this.alpha=1,this.rotation=0,this.flipX=!1,this.flipY=!1,this.scaleX=1,this.scaleY=1,this.visible=!0,this.autoChange=!1,r.superclass.constructor.call(this,t)};e.inherit(r,o),r.prototype.onshow=e.fn,r.prototype.onhide=e.fn,r.prototype.onupdate=e.fn,r.prototype.onrender=e.fn,r.prototype.ondraw=e.fn,r.prototype.borderCheck=function(){},r.prototype.customDraw=function(t){},r.prototype._draw=function(t){this.customDraw(t),this.ondraw()},r.prototype._transform=function(t){},r.prototype.render=function(t){return!this.visible||this.alpha<=0?!1:(t.save(),this._transform(t),this._draw(t),t.restore(),void this.onrender())},r.prototype.update=function(t){this.vx=this.vx+this.ax*(t/1e3),this.vy=this.vy+this.ay*(t/1e3),this.x+=this.vx,this.y+=this.vy,(this.x<this.rangeX[0]-this.width||this.x>this.rangeX[1]+this.width&&this.y<this.rangeY[0]-this.height||this.y>this.rangeY[1]+this.height)&&(this.visible=!1),this.autoChange&&this.parent&&this.parent.change&&this.parent.change(),this.onupdate(t)},t.exports=r},function(t,n,i){var e=i(1),o=function(t){this.initialized=!1,this.parent=null,e.extend(this,t)};o.prototype.oninit=e.fn,o.prototype.ondestory=e.fn,o.prototype.init=function(){this.initialized=!0,this.oninit()},o.prototype.destory=function(){this.parent&&this.parent.removeChild&&(this.parent.removeChild(this),this.parent=null),this.ondestory&&this.ondestory(),this.oninit=this.ondestory=null},t.exports=o},function(t,n,i){var e=i(2),o=function(t,n,i,o,r){var s=new e({width:n,height:i,img:t,speed:o,rollLen:0,isVertical:r,autoChange:!0});return s.customDraw=function(t){var n=this.speed>0?1:-1;return 0===this.speed?void t.drawImage(this.img,0,0,this.width,this.height):void(this.isVertical?(t.drawImage(this.img,0,this.rollLen-n*this.height,this.width,this.height),t.drawImage(this.img,0,this.rollLen,this.width,this.height)):(t.drawImage(this.img,-n*this.width+this.rollLen,0,this.width,this.height),t.drawImage(this.img,this.rollLen,0,this.width,this.height)))},s.update=function(){this.rollLen+=this.speed;var t=this.speed>0?1:-1;(this.isVertical&&t*this.rollLen>this.height||!this.isVertical&&t*this.rollLen>this.width)&&(this.rollLen=0),this.parent.change()},s};t.exports=o},function(t,n,i){function e(t,n,i){for(var e=0;t>e;e++){var s=["#005588","#080"],a=Math.random()>.5?1:0,h=new o({index:e,type:"particle",x:Math.round(n*Math.random()),y:0,rangeX:[0,n],rangeY:[0,i],vy:2*Math.random(),vx:0,radius:10,width:20,height:20,color:s[a],autoChange:!0});h.customDraw=function(t){var n=this;t.beginPath(),t.fillStyle=n.color,t.arc(n.x,n.y,n.radius,0,2*Math.PI,!0),t.closePath(),t.fill()},r.push(h)}return r}var o=i(2),r=[];t.exports=e},function(t,n,i){"use strict";var e=i(1),o=i(2),r=i(14),s=function(t){this.width=113,this.height=106,e.isMobile()?this.eventType={start:"touchstart",move:"touchmove",end:"touchend"}:this.eventType={start:"mousedown",move:"mousemove",end:"mouseup"},s.superclass.constructor.call(this,t)};e.inherit(s,o),s.prototype.onHit=function(){},s.prototype.addControl=function(t){var n=this,i=!1;return e.addHandler(t,this.eventType.start,function(t){n.setPosition(t),i=!0}),e.addHandler(t,this.eventType.move,function(t){t.preventDefault(),i&&n.setPosition(t)}),e.addHandler(t,this.eventType.end,function(t){i=!1}),this},s.prototype._insideBoundary=function(){var t=[0,320],n=[0,640];this.x<t[0]?this.x=t[0]:this.x>t[1]-this.width&&(this.x=t[1]-this.width),this.y<n[0]?this.y=n[0]:this.y>n[1]-this.height&&(this.y=n[1]-this.height)},s.prototype.setPosition=function(t){return console.log(t.clientX,"y:",t.clientY),e.isMobile()?(this.x=event.changedTouches[0].clientX-this.width/2,this.y=event.changedTouches[0].clientY-this.height/2):(this.x=t.clientX-this.width/2,this.y=t.clientY-this.height/2),this._insideBoundary(),this.parent.change(),this},s.prototype.hitTest=function(t){for(var n=0,i=0,e=t.length;e>i;i++)n=t[i],n.visible&&r.rectCollision(this,n)&&this.onHit.call(this,n,i)},s.prototype.customDraw=function(t){t.drawImage(this.img,this.x,this.y)},t.exports=s},function(t,n,i){var e=i(1),o=i(2),r=function(t){this.childs=[],r.superclass.constructor.call(this,t)};e.inherit(r,o),r.prototype.init=function(){for(var t=this.childs,n=0;n<t.length;n++)t[n].initialized||t[n].init();r.superclass.init.call(this)},r.prototype.render=function(t){for(var n=this.childs,i=0,e=n.length;e>i;i++)n[i].render(t);r.superclass.render.call(this,t)},r.prototype.update=function(t){for(var n=this.childs,i=0,e=n.length;e>i;i++)n[i].update.call(n[i],t);r.superclass.update.call(this,t)},r.prototype.destroyChilds=function(){var t=this.childs;if(t)for(var n=0;n<t.length;n++)t[n].initialized&&t[n].destroy()},r.prototype.destroy=function(){this.destroyChilds(),this.childs=null},r.prototype.appendChild=function(t){this.addChildAt(t,this.childs.length-1)},r.prototype.appendChilds=function(t){for(var n=0;n<t.length;n++)this.appendChild(t[n])},r.prototype.addChildAt=function(t,n){t.parent=this,this.childs.splice(n,0,t)},r.prototype.removeChild=function(t){for(var n=this.childs,i=0,e=n.length;e>i;i++)if(n[i]===t){this.removeChildAt(i);break}},r.prototype.removeChildAt=function(t){var n=this.childs.splice(t);n&&(n.parent=null)},t.exports=r},function(t,n,i){var e=i(1),o=i(3);i(13);var r=function(t){this.playing=!1,this.layers=[],this._timeout=null,r.superclass.constructor.call(this,t)};e.inherit(r,o),r.prototype.onstart=e.fn,r.prototype.onpause=e.fn,r.prototype.onstop=e.fn,r.prototype.start=function(){this.playing||(this.playing=!0,window.requestAnimationFrame(this._run.bind(this)),this.onstart())},r.prototype.restart=function(){this.clear(),this.start()},r.prototype.addLayer=function(t){!this.layers&&(this.layers=[]),this.layers.push(t)},r.prototype.clear=function(){var t=this.layers;if(t&&t.length>0)for(var n=0,i=t.length;i>n;n++)t[n].clear()},r.prototype.render=function(){var t=this.layers;if(t&&t.length>0)for(var n=0,i=t.length;i>n;n++)t[n].render()},r.prototype.update=function(t){var n=this.layers;if(n&&n.length>0)for(var i=0,e=n.length;e>i;i++)n[i].update(t)},r.prototype._run=function(t){this.update(t),this.clear(),this.render(),this._timeout=window.requestAnimationFrame(this._run.bind(this))},r.prototype.pause=function(){this.playing=!1,this.onpause()},r.prototype.stop=function(){this.playing&&(window.cancelAnimationFrame(this._timeout),this.playing=!1,this.onstop())},r.prototype.destroy=function(){this.stop(),this.clear();var t=this.layers;if(t&&t.length>0)for(var n=0,i=t.length;i>n;n++)t[n].destroy();this.layers=null,r.superclass.destory.call(this)},t.exports=r},function(t,n,i){var e=i(1),o=i(7),r=function(t){this.canvas=null,this.context=null,this._change=!0,r.superclass.constructor.call(this,t),t&&t.canvas&&this.setCanvas(t.canvas)};e.inherit(r,o),r.prototype.setCanvas=function(t){return"string"==typeof t&&(t=document.getElementById(t)),t&&t.getContext("2d")&&(this.canvas=t,this.context=t.getContext("2d")),this.canvas},r.prototype.change=function(){this._change=!0},r.prototype.render=function(){this._change&&(r.superclass.render.call(this,this.context),this._change=!1)},r.prototype.clear=function(){this.context&&this._change&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t.exports=r},function(t,n,i){function e(t,n){var i=t/n*100;document.getElementById("loadProgress").innerHTML=i}function o(){g++,document.getElementById("score").innerHTML=g}function r(){var t=new m({canvas:"bg"}),n=t.context;n.drawImage(u.get("bg"),0,0);var i=f(u.get("bg"),320,1126,1,!0);return t.appendChild(i),t}function s(){var t=new m,n=t.setCanvas("main"),i=(t.context,15),e=l(i,n.width,n.height);t.appendChilds(e);var r=new p({img:u.get("player"),width:112,height:106,radius:50,x:n.width/2-50,y:n.height/2-40});return r.addControl(document.getElementById("gamePannel")),r.onHit=function(t,n){t.visible=!1,o()},t.appendChild(r),t.onupdate=function(){var i=0,o=[];if(r.hitTest(e),t.childs.forEach(function(t,n){"string"==typeof t.type&&"particle"==t.type&&(t.visible?i++:o.push(n))}),10>i&&o.length>0){var s,a=o.shift();s=t.childs[a],s.x=Math.round(n.width*Math.random()),s.y=0,s.visible=!0}},t}function a(){var t=new y,n=r(),i=s();return t.addLayer(n),t.addLayer(i),document.getElementById("start").onclick=function(){t.start()},document.getElementById("stop").onclick=function(){t.stop()},document.getElementById("destroy").onclick=function(){t.destroy()},t}function h(t){return t?(document.getElementById("operation").style.display="block",void a()):(alert("加载游戏出错，请稍后再试！"),!1)}function c(){u.load(d,h,e)}var u=i(12),d=i(11),l=i(5),p=i(6),f=i(4),y=i(8),m=i(9),g=0;t.exports=c},function(t,n){var i=[{key:"bg",url:"./images/bg.jpg"},{key:"player",url:"./images/player.png"}];t.exports=i},function(t,n){"use strict";function i(t,n,i){if(a[i])return void n(!0);var e=new Image;e.src=t,e.onload=function(){i&&(a[i]=e),n(!0),e.onload=e.onerror=null},e.onerror=function(){i&&(a[i]=null),n(!1)}}function e(t,n,e,o){function r(){h++,"function"==typeof e&&e(h,t.length),t.length===h&&(a.state="loaded",clearTimeout(s),n(!0))}0===t.length&&n(!0);var s=null;s=setTimeout(function(){n(!1)},o||1e4),a.state="loading";for(var c=0;c<t.length;c++)i(t[c].url,r,t[c].key,o)}function o(t){return a[t]}function r(){return a.state}function s(){return a}var a={state:"init"},h=0,c={load:e,get:o,getList:s,getState:r};t.exports=c},function(t,n){!function(){for(var t=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[n[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[i]+"CancelAnimationFrame"]||window[n[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n,i){var e=(new Date).getTime(),o=Math.max(0,16-(e-t)),r=window.setTimeout(function(){n(e+o)},o);return t=e+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()},function(t,n){var i={norm:function(t,n,i){return(t-n)/(i-n)},lerp:function(t,n,i){return(i-n)*t+n},map:function(t,n,e,o,r){return i.lerp(i.norm(t,n,e),o,r)},clamp:function(t,n,i){return Math.min(Math.max(t,Math.min(n,i)),Math.max(n,i))},distance:function(t,n){var i=n.x-t.x,e=n.y-t.y;return Math.sqrt(i*i+e*e)},distanceXY:function(t,n,i,e){var o=i-t,r=e-n;return Math.sqrt(o*o+r*r)},circleCollision:function(t,n){return i.distance(t,n)<=t.radius+n.radius},circlePointCollision:function(t,n,e){return i.distanceXY(t,n,e.x,e.y)<e.radius},rectCollision:function(t,n){var i=t.x>n.x+n.width,e=t.x+t.width<n.x,o=t.y>n.y+n.height,r=t.y+t.height<n.y;return!(i||e||o||r)},inRange:function(t,n,i){return t>=Math.min(n,i)&&t<=Math.max(n,i)},pointInRect:function(t,n,e){return i.inRange(t,e.x,e.x+e.width)&&i.inRange(n,e.y,e.y+e.height)},rangeIntersect:function(t,n,i,e){return Math.max(t,n)>=Math.min(i,e)&&Math.min(t,n)<=Math.max(i,e)},rectIntersect:function(t,n){return i.rangeIntersect(t.x,t.x+t.width,n.x,n.x+n.width)&&i.rangeIntersect(t.y,t.y+t.height,n.y,n.y+n.height)},degreesToRads:function(t){return t/180*Math.PI},radsToDegrees:function(t){return 180*t/Math.PI},randomRange:function(t,n){return t+Math.random()*(n-t)},randomInt:function(t,n){return t+Math.random()*(n-t+1)},getmiddle:function(t,n){var i=t.x,e=n.x;middlex=(i+e)/2;var o=t.y,r=n.y;return middley=(o+r)/2,pos=[middlex,middley],pos},getAngle:function(t,n){var i=n.x-t.x,e=n.y-t.y,o=Math.atan2(e,i);return o},inpercentW:function(t){return t*W/100},inpercentH:function(t){return t*H/100}};t.exports=i}])});